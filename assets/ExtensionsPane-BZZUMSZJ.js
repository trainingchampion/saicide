import{v as i,j as e,bI as L,S,a3 as R,bJ as E,z,ai as A,aH as U}from"./vendor-react-tt7m-l12.js";import{F as w}from"./index.dev-B-tTqmd2.js";import"./vendor-mcp-DCT6vnr2.js";import"./vendor-misc-euQLCzIo.js";import"./vendor-network-aHtHbEbM.js";import"./vendor-terminal-D4sCRDlA.js";import"./vendor-ai-BVRLdj29.js";const M=t=>t>=1e6?(t/1e6).toFixed(1)+"M":t>=1e3?(t/1e3).toFixed(1)+"K":t.toString(),N=t=>t?t.map(r=>{var n,o,a;return{id:`${r.namespace}.${r.name}`,name:r.displayName||r.name,publisher:r.namespace,description:r.description||"",iconUrl:((n=r.files)==null?void 0:n.icon)||"",downloads:(o=r.statistics)!=null&&o.downloadCount?M(r.statistics.downloadCount):"0",rating:((a=r.statistics)==null?void 0:a.averageRating)||4.5,category:"Extension",isRecommended:!1}}):[],F=async t=>{const r=t.trim();try{const n=`/api/extensions?query=${encodeURIComponent(r)}`,o=await fetch(n);if(o.ok){const a=await o.json();if(Array.isArray(a))return N(a)}}catch{}try{const o=`https://open-vsx.org/api/-/search?${new URLSearchParams({query:r,size:"20",sortBy:r?"relevance":"downloadCount",sortOrder:"desc"})}`,a=await fetch(o);if(a.ok){const l=await a.json();if(l&&Array.isArray(l.extensions))return N(l.extensions)}}catch{}return console.warn("Using fallback extensions due to API unavailability."),r?w.filter(n=>n.name.toLowerCase().includes(r.toLowerCase())||n.description.toLowerCase().includes(r.toLowerCase())):w},C={searchExtensions:F},d=({title:t,count:r,children:n,isLoading:o})=>{const[a,l]=i.useState(!0);return e.jsxs("div",{className:"mb-4",children:[e.jsxs("button",{onClick:()=>l(!a),className:"w-full flex items-center justify-between p-2 hover:bg-white/5 rounded-md",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a?e.jsx(z,{size:16}):e.jsx(A,{size:16}),e.jsx("h3",{className:"text-sm font-bold text-white uppercase tracking-wider",children:t})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[o&&e.jsx(U,{size:14,className:"animate-spin text-gray-400"}),e.jsx("span",{className:"text-xs bg-gray-800 text-gray-400 px-2 py-0.5 rounded-full font-mono",children:r})]})]}),a&&e.jsx("div",{className:"mt-2 space-y-1",children:n})]})},m=({extension:t,isInstalled:r,onInstall:n,onUninstall:o})=>{const a=t.id.split(".")[0];return e.jsxs("div",{className:"flex items-center gap-4 p-3 hover:bg-[var(--color-background-tertiary)]/50 transition-colors rounded-lg group",children:[t.iconUrl?e.jsx("img",{src:t.iconUrl,alt:t.name,className:"w-12 h-12 rounded-md object-cover bg-gray-800 flex-shrink-0",onError:l=>{l.currentTarget.src=`https://ui-avatars.com/api/?name=${encodeURIComponent(t.name)}&background=374151&color=fff&size=48`}}):e.jsx("div",{className:"w-12 h-12 rounded-md bg-gray-700 flex items-center justify-center text-lg font-bold text-gray-400 flex-shrink-0",children:t.name.substring(0,2).toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-white truncate text-base",children:t.name}),e.jsx("p",{className:"text-sm text-gray-400 mt-1 truncate",children:t.description}),e.jsx("span",{className:"text-xs text-gray-500 mt-2 block",children:a})]}),e.jsx("div",{className:"ml-4 flex-shrink-0",children:r?e.jsx("button",{className:"p-1 text-gray-500 hover:text-white hover:bg-white/10 rounded-full",title:"Manage extension",children:e.jsx(S,{size:16})}):e.jsx("button",{onClick:n,className:"text-xs bg-blue-600 hover:bg-blue-500 text-white font-bold py-1.5 px-4 rounded-md transition-colors",children:"Install"})})]})},q=({installedExtensions:t,onInstall:r,onUninstall:n,onCollapse:o})=>{const[a,l]=i.useState(""),[u,f]=i.useState([]),[g,I]=i.useState([]),[j,b]=i.useState(!1),[k,y]=i.useState(!0),v=i.useMemo(()=>new Set(t.map(s=>s.id)),[t]);i.useEffect(()=>{(async()=>{y(!0);try{const c=await C.searchExtensions("");I(c.slice(0,5).map(x=>({...x,isRecommended:!0})))}catch(c){console.error(c)}finally{y(!1)}})()},[]),i.useEffect(()=>{let s=!0;const x=setTimeout(async()=>{if(!a){f([]);return}b(!0);try{const p=await C.searchExtensions(a);s&&f(p)}catch(p){console.error(p)}finally{s&&b(!1)}},300);return()=>{s=!1,clearTimeout(x)}},[a]);const h=i.useMemo(()=>a?t.filter(s=>s.name.toLowerCase().includes(a.toLowerCase())||s.publisher.toLowerCase().includes(a.toLowerCase())):t,[t,a]);return e.jsxs("div",{className:"p-2 h-full flex flex-col bg-[var(--color-background-secondary)]",children:[e.jsxs("div",{className:"flex justify-between items-center p-2 flex-shrink-0",children:[e.jsx("h2",{className:"text-sm font-semibold text-white px-1",children:"Extensions"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>alert("More actions: Sort by installs, filter, etc."),title:"More Actions",className:"p-1.5 hover:bg-white/5 rounded text-gray-400 hover:text-white transition-all",children:e.jsx(L,{size:16})}),e.jsx("button",{onClick:()=>alert("Extension settings: Auto-update, etc."),title:"Settings",className:"p-1.5 hover:bg-white/5 rounded text-gray-400 hover:text-white transition-all",children:e.jsx(S,{size:16})})]})]}),e.jsxs("div",{className:"relative px-2 pb-2",children:[e.jsx("span",{className:"absolute inset-y-0 left-0 flex items-center pl-4 text-gray-500",children:e.jsx(R,{size:16})}),e.jsx("input",{type:"text",placeholder:"Search Extensions in Marketplace",value:a,onChange:s=>l(s.target.value),className:"w-full bg-[var(--color-background-tertiary)] border border-[var(--color-border)] rounded-md py-2 pl-9 pr-8 text-sm focus:outline-none focus:ring-1 focus:ring-[var(--color-accent)] transition-all placeholder-gray-500"}),e.jsx("button",{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-500 hover:text-white",children:e.jsx(E,{size:16})})]}),e.jsxs("div",{className:"mt-1 px-2 text-[11px] text-[var(--color-text-secondary)]",children:["By default, S.AI uses ",e.jsx("a",{href:"https://open-vsx.org",target:"_blank",rel:"noopener noreferrer",className:"text-[var(--color-accent)] hover:underline",children:"Open VSX"}),". This can be changed in settings."]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 mt-2 custom-scrollbar",children:a?e.jsxs(e.Fragment,{children:[h.length>0&&e.jsx(d,{title:"Installed",count:h.length,children:h.map(s=>e.jsx(m,{extension:s,isInstalled:!0,onInstall:()=>r(s),onUninstall:()=>n(s.id)},s.id))}),e.jsxs(d,{title:"Marketplace",count:u.length,isLoading:j,children:[u.map(s=>e.jsx(m,{extension:s,isInstalled:v.has(s.id),onInstall:()=>r(s),onUninstall:()=>n(s.id)},s.id)),!j&&u.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:"No results found."})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{title:"Installed",count:t.length,children:t.length>0?t.map(s=>e.jsx(m,{extension:s,isInstalled:!0,onInstall:()=>r(s),onUninstall:()=>n(s.id)},s.id)):e.jsx("div",{className:"text-center py-4 text-gray-500 text-xs italic",children:"No extensions installed."})}),e.jsx(d,{title:"Recommended",count:g.length,isLoading:k,children:g.map(s=>e.jsx(m,{extension:s,isInstalled:v.has(s.id),onInstall:()=>r(s),onUninstall:()=>n(s.id)},s.id))})]})})]})};export{q as default};
