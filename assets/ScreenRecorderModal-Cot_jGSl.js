import{v as s,j as e,cu as xe,X as J,b9 as me,I as fe,au as K,a_ as he,E as pe,bM as ge,aB as we,bc as be,ah as ve,bn as je,aI as ye}from"./vendor-react-tt7m-l12.js";import{c as Ne}from"./creatorService-CcEU7H7b.js";import"./index.dev-vR_ZKarG.js";import"./vendor-mcp-CN8JrFe1.js";import"./vendor-misc-sHEHZw9n.js";import"./vendor-network-DBeEYzJJ.js";import"./vendor-terminal-D4sCRDlA.js";import"./vendor-ai-BVRLdj29.js";const U=({checked:l,onChange:h,disabled:p})=>e.jsx("button",{onClick:h,disabled:p,className:`w-11 h-6 rounded-full p-1 transition-all duration-300 ease-in-out ${l?"bg-[#34c759]":"bg-[#3a3a3c]"} ${p?"opacity-50 cursor-not-allowed":""}`,children:e.jsx("div",{className:`w-4 h-4 bg-white rounded-full shadow-sm transform transition-transform duration-300 ${l?"translate-x-5":"translate-x-0"}`})}),Pe=({isOpen:l,onClose:h,onSave:p})=>{const[i,u]=s.useState("setup"),[g,$]=s.useState(!0),[j,Q]=s.useState(!0),[x,Z]=s.useState(!0),[y,V]=s.useState(0),[k,W]=s.useState(3),[N,B]=s.useState(null),[L,O]=s.useState(null),[ee,te]=s.useState("video/webm"),[S,se]=s.useState(!1),[re,X]=s.useState(!1),[F,C]=s.useState(null),[M,H]=s.useState({x:window.innerWidth-320,y:100}),[z,Y]=s.useState({x:window.innerWidth/2-100,y:window.innerHeight-100}),T=s.useRef(M),I=s.useRef(z),P=s.useRef(!1),D=s.useRef(!1),w=s.useRef({x:0,y:0}),R=s.useRef(null),A=s.useRef([]),b=s.useRef(null),ne=s.useRef(null),m=s.useRef(null),v=s.useRef(null),f=s.useRef(null),E=s.useRef(null);s.useEffect(()=>{l?(u("setup"),B(null),O(null),C(null),V(0),H({x:window.innerWidth-320,y:100}),Y({x:window.innerWidth/2-100,y:window.innerHeight-100}),T.current={x:window.innerWidth-320,y:100},I.current={x:window.innerWidth/2-100,y:window.innerHeight-100}):G()},[l]),s.useEffect(()=>{let t=!0;return(async()=>{var a;if(!l||!g){f.current&&(f.current.getTracks().forEach(n=>n.stop()),f.current=null);return}try{if((a=f.current)!=null&&a.active)return;const n=await navigator.mediaDevices.getUserMedia({video:{width:640,height:480,facingMode:"user"},audio:!1});t?(f.current=n,E.current&&(E.current.srcObject=n)):n.getTracks().forEach(d=>d.stop())}catch(n){console.error("Camera error:",n),$(!1)}})(),()=>{t=!1}},[l,g]),s.useEffect(()=>{let t;return i==="recording"&&!S&&(t=setInterval(()=>V(r=>r+1),1e3)),()=>clearInterval(t)},[i,S]),s.useEffect(()=>{if(i==="countdown")if(k>0){const t=setTimeout(()=>W(r=>r-1),1e3);return()=>clearTimeout(t)}else ae()},[i,k]);const G=()=>{var t,r,a;(t=m.current)==null||t.getTracks().forEach(n=>n.stop()),(r=v.current)==null||r.getTracks().forEach(n=>n.stop()),(a=f.current)==null||a.getTracks().forEach(n=>n.stop()),b.current&&b.current.state!=="closed"&&b.current.close()},ie=async()=>{try{const t=new(window.AudioContext||window.webkitAudioContext);b.current=t;const r=await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"monitor"},audio:!0});if(m.current=r,r.getVideoTracks()[0].onended=()=>q(),j){const a=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:x,noiseSuppression:x,autoGainControl:x}});v.current=a}W(3),u("countdown")}catch(t){console.error("Failed to start:",t),alert("Could not start screen capture.")}},ae=()=>{if(!m.current)return;const t=b.current;if(!t)return;const r=t.createMediaStreamDestination();if(m.current.getAudioTracks().length>0){const c=t.createMediaStreamSource(m.current),o=t.createGain();o.gain.value=1,c.connect(o).connect(r)}if(v.current&&v.current.getAudioTracks().length>0){const c=t.createMediaStreamSource(v.current),o=t.createGain();o.gain.value=1,c.connect(o).connect(r)}const a=[...m.current.getVideoTracks(),...r.stream.getAudioTracks()],n=new MediaStream(a);A.current=[];let d="video/webm;codecs=vp9";MediaRecorder.isTypeSupported("video/mp4")&&(d="video/mp4"),te(d);try{const c=new MediaRecorder(n,{mimeType:d});c.ondataavailable=o=>{o.data.size>0&&A.current.push(o.data)},c.onstop=()=>{const o=new Blob(A.current,{type:d}),ue=URL.createObjectURL(o);O(o),B(ue),u("preview"),G()},c.start(1e3),R.current=c,u("recording")}catch(c){console.error("Recorder error",c),alert("Failed to initialize recorder.")}},q=()=>{R.current&&R.current.state!=="inactive"?R.current.stop():(G(),u("preview"))},ce=()=>{if(!N||!p)return;const t=L?(L.size/(1024*1024)).toFixed(1):"0",r=new Date().toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),a=Math.floor(y/60),n=y%60,d=`${String(a).padStart(2,"0")}:${String(n).padStart(2,"0")}`,c={id:`rec-${Date.now()}`,name:`Capture ${new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`,url:N,size:`${t}MB`,date:r,duration:d,mimeType:ee};p(c),h()},_=(t,r)=>{r==="pip"?P.current=!0:D.current=!0;const a=r==="pip"?T.current:I.current;w.current={x:t.clientX-a.x,y:t.clientY-a.y}},oe=t=>{if(P.current){const r={x:t.clientX-w.current.x,y:t.clientY-w.current.y};T.current=r,H(r)}if(D.current){const r={x:t.clientX-w.current.x,y:t.clientY-w.current.y};I.current=r,Y(r)}},le=()=>{P.current=!1,D.current=!1},de=async()=>{X(!0);try{const t=await Ne.runGenericTool({prompt:"Analyze this screen recording for pacing, clarity, and viral potential."},"gemini-3-pro-preview","Video Review");C(t)}catch{C("Analysis failed.")}finally{X(!1)}};return l?e.jsxs("div",{className:"fixed inset-0 z-[200] flex flex-col pointer-events-none font-sans",onMouseMove:oe,onMouseUp:le,children:[e.jsx("canvas",{ref:ne,className:"hidden"}),g&&i!=="preview"&&e.jsxs("div",{className:"absolute z-[210] rounded-full overflow-hidden shadow-2xl border-4 border-white/20 pointer-events-auto cursor-move transition-transform active:scale-95 group",style:{width:i==="setup"?180:220,height:i==="setup"?180:220,left:i==="setup"?"50%":M.x,top:i==="setup"?"20%":M.y,transform:i==="setup"?"translateX(-50%)":"none"},onMouseDown:t=>i!=="setup"&&_(t,"pip"),children:[e.jsx("video",{ref:E,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover transform scale-x-[-1] bg-black"}),i==="recording"&&e.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsx(xe,{className:"text-white"})})]}),i==="setup"&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/40 backdrop-blur-sm pointer-events-auto animate-fade-in",children:e.jsxs("div",{className:"w-[360px] bg-[#1c1c1e]/90 backdrop-blur-xl border border-white/10 rounded-[32px] p-6 shadow-2xl flex flex-col gap-6 relative mt-32",children:[e.jsxs("div",{className:"flex justify-between items-center px-1",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h2",{className:"text-white font-bold text-lg",children:"Studio Recorder"}),e.jsx("p",{className:"text-[10px] text-gray-400 font-medium",children:"Configure your session"})]}),e.jsx("button",{onClick:h,className:"bg-[#2c2c2e] hover:bg-[#3a3a3c] p-2 rounded-full text-gray-400 hover:text-white transition-colors",children:e.jsx(J,{size:16})})]}),e.jsxs("div",{className:"bg-[#2c2c2e]/50 rounded-2xl overflow-hidden divide-y divide-white/5 border border-white/5",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-white/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white",children:e.jsx(me,{size:16,fill:"currentColor"})}),e.jsx("span",{className:"text-sm text-white font-medium",children:"Camera"})]}),e.jsx(U,{checked:g,onChange:()=>$(!g)})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-white/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-500 flex items-center justify-center text-white",children:e.jsx(fe,{size:16,fill:"currentColor"})}),e.jsx("span",{className:"text-sm text-white font-medium",children:"Microphone"})]}),e.jsx(U,{checked:j,onChange:()=>Q(!j)})]}),j&&e.jsxs("div",{className:"flex items-center justify-between p-4 bg-[#2c2c2e]/80",children:[e.jsxs("div",{className:"flex items-center gap-3 pl-1",children:[e.jsx(K,{size:18,className:x?"text-purple-400":"text-gray-500"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm text-white font-medium",children:"Voice Isolation"}),e.jsx("span",{className:"text-[10px] text-gray-400",children:"AI Noise Reduction"})]})]}),e.jsx(U,{checked:x,onChange:()=>Z(!x)})]})]}),e.jsxs("button",{onClick:ie,className:"w-full bg-white hover:bg-gray-100 text-black font-bold py-4 rounded-[20px] text-sm tracking-wide shadow-lg transition-all active:scale-[0.98] flex items-center justify-center gap-2",children:[e.jsx(he,{size:16,fill:"currentColor",className:"text-red-500"}),"Start Recording"]})]})}),i==="countdown"&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/20 backdrop-blur-sm pointer-events-auto z-[300]",children:e.jsx("div",{className:"text-[150px] font-black text-white drop-shadow-2xl animate-ping",children:k})}),i==="recording"&&e.jsx("div",{className:"absolute pointer-events-auto z-[220]",style:{left:z.x,top:z.y},onMouseDown:t=>_(t,"control"),children:e.jsxs("div",{className:"bg-black/80 backdrop-blur-xl border border-white/10 rounded-full py-2 px-4 flex items-center gap-4 shadow-2xl cursor-move hover:scale-105 transition-transform group",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2.5 h-2.5 bg-red-500 rounded-full animate-pulse"}),e.jsxs("span",{className:"font-mono text-white text-sm font-medium tracking-widest",children:[Math.floor(y/60),":",String(y%60).padStart(2,"0")]})]}),e.jsx("div",{className:"h-4 w-px bg-white/20"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>se(!S),className:"p-2 rounded-full hover:bg-white/10 text-white transition-colors",children:S?e.jsx(pe,{size:18,fill:"currentColor"}):e.jsx(ge,{size:18,fill:"currentColor"})}),e.jsx("button",{onClick:q,className:"p-2 rounded-full bg-red-500 hover:bg-red-400 text-white transition-colors shadow-lg",children:e.jsx(we,{size:14,fill:"currentColor"})})]})]})}),i==="preview"&&N&&e.jsx("div",{className:"absolute inset-0 bg-black/80 backdrop-blur-md pointer-events-auto flex items-center justify-center p-8 animate-fade-in",children:e.jsxs("div",{className:"bg-[#1c1c1e] w-full max-w-5xl rounded-[24px] border border-white/10 shadow-2xl flex flex-col overflow-hidden max-h-[90vh]",children:[e.jsxs("div",{className:"p-6 border-b border-white/5 flex items-center justify-between bg-[#2c2c2e]/50",children:[e.jsxs("h2",{className:"text-lg font-bold text-white flex items-center gap-2",children:[e.jsx(be,{size:18,className:"text-gray-400"})," Recording Preview"]}),e.jsx("button",{onClick:h,className:"p-2 hover:bg-white/10 rounded-full text-gray-400 hover:text-white transition-colors",children:e.jsx(J,{size:20})})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"flex-1 bg-black flex items-center justify-center p-4",children:e.jsx("video",{src:N,controls:!0,className:"max-w-full max-h-full rounded-lg shadow-2xl border border-white/5"})}),e.jsxs("div",{className:"w-80 bg-[#1c1c1e] border-l border-white/5 p-6 flex flex-col gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider mb-4",children:"Neural Review"}),e.jsx("div",{className:"bg-white/5 rounded-xl p-4 min-h-[120px] flex flex-col items-center justify-center text-center border border-white/5",children:re?e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"animate-spin text-purple-500 mb-2",size:20}),e.jsx("span",{className:"text-xs text-gray-400",children:"Analyzing content..."})]}):F?e.jsx("p",{className:"text-xs text-gray-300 leading-relaxed text-left",children:F}):e.jsxs("button",{onClick:de,className:"flex flex-col items-center gap-2 text-gray-400 hover:text-purple-400 transition-colors",children:[e.jsx(K,{size:24}),e.jsx("span",{className:"text-xs font-medium",children:"Generate Summary"})]})})]}),e.jsxs("div",{className:"mt-auto space-y-3",children:[e.jsxs("button",{onClick:ce,className:"w-full py-3 bg-white text-black rounded-xl font-bold text-sm flex items-center justify-center gap-2 hover:bg-gray-200 transition-colors",children:[e.jsx(je,{size:16})," Save to Library"]}),e.jsxs("button",{onClick:()=>u("setup"),className:"w-full py-3 bg-[#2c2c2e] text-white rounded-xl font-bold text-sm flex items-center justify-center gap-2 hover:bg-[#3a3a3c] transition-colors",children:[e.jsx(ye,{size:16})," New Recording"]})]})]})]})]})})]}):null};export{Pe as default};
