import{v as f,j as s,a3 as H,ah as G,aP as K,am as Q,E as _,z as Y,ai as Z,F as ee,a5 as se,aL as te,aF as ne,aG as ae,aj as ie}from"./vendor-react-tt7m-l12.js";import{I as le}from"./index.dev-DC3GzjrE.js";import"./vendor-mcp-DCT6vnr2.js";import"./vendor-misc-euQLCzIo.js";import"./vendor-network-aHtHbEbM.js";import"./vendor-terminal-D4sCRDlA.js";import"./vendor-ai-BVRLdj29.js";const R=(o,d="")=>{let j=[];return o.type==="file"&&o.content&&j.push({name:d?`${d}/${o.name}`:o.name,content:o.content}),o.children&&o.children.forEach(w=>{j=j.concat(R(w,d?`${d}/${o.name}`:o.name))}),j},ue=({onCollapse:o,fileStructure:d,setFileStructure:j,onRunTest:w,onWriteToTerminal:O,securityIssues:D,policies:U,onGoToFile:B,activeExplorerFile:$})=>{const[p,C]=f.useState([]),[F,T]=f.useState(new Set),[N,k]=f.useState(!1),[S,z]=f.useState(!1),P=f.useRef(null);f.useEffect(()=>{W()},[d]),f.useEffect(()=>{if($){const n=$.path;p.some(t=>t.file===n)&&T(t=>{if(t.has(n))return t;const l=new Set(t);return l.add(n),l})}},[$,p]);const W=()=>{const l=R(d,"").map(e=>({...e,name:e.name.replace(d.name+"/","")})).filter(e=>e.name.endsWith(".test.tsx")||e.name.endsWith(".test.ts")||e.name.endsWith(".spec.js")||e.name.endsWith(".spec.ts")||e.name.endsWith("_test.py")||e.name.startsWith("test_")||e.name.endsWith("_test.go")||e.name.endsWith(".rs")&&e.content.includes("#[test]")).map(e=>{var v,m;const a=[],u=e.name.endsWith(".py"),r=e.name.endsWith(".go"),h=e.name.endsWith(".rs");if(u){const g=/class\s+(\w+)/g,x=/def\s+(test_\w+)/g;let c;for(;(c=g.exec(e.content))!==null;)a.push({id:`${e.name}-${c[1]}`,name:c[1],file:e.name,type:"suite",status:"idle",children:[]});for(;(c=x.exec(e.content))!==null;){const b={id:`${e.name}-${c[1]}`,name:c[1],file:e.name,type:"test",status:"idle"};a.length>0?(v=a[a.length-1].children)==null||v.push(b):a.push(b)}}else if(r){const g=/func\s+(Test\w+)\(/g;let x;for(;(x=g.exec(e.content))!==null;)a.push({id:`${e.name}-${x[1]}`,name:x[1],file:e.name,type:"test",status:"idle"})}else if(h){const g=/#\[test\]\s*fn\s+(\w+)\(\)/g;let x;for(;(x=g.exec(e.content))!==null;)a.push({id:`${e.name}-${x[1]}`,name:x[1],file:e.name,type:"test",status:"idle"})}else{const g=/(?:describe|suite)\s*\(\s*['"`](.+?)['"`]/g,x=/(?:it|test)\s*\(\s*['"`](.+?)['"`]/g;let c;for(;(c=g.exec(e.content))!==null;)a.push({id:`${e.name}-${c[1]}`,name:c[1],file:e.name,type:"suite",status:"idle",children:[]});for(;(c=x.exec(e.content))!==null;){const b={id:`${e.name}-${c[1]}`,name:c[1],file:e.name,type:"test",status:"idle"};a.length>0?(m=a[a.length-1].children)==null||m.push(b):a.push(b)}}return a.length===0&&e.name.match(/test/i)?{id:e.name,name:e.name.split("/").pop()||e.name,file:e.name,type:"test",status:"idle"}:{id:e.name,name:e.name.split("/").pop()||e.name,file:e.name,type:"suite",status:"idle",children:a}});C(l),T(e=>{const a=new Set(e);return l.forEach(u=>a.add(u.id)),a})},A=()=>{z(!0),setTimeout(()=>{W(),z(!1)},1e3)},M=n=>{var l;const i=(l=n.target.files)==null?void 0:l[0];if(!i)return;const t=new FileReader;t.onload=e=>{var r;const a=(r=e.target)==null?void 0:r.result,u={name:i.name,type:"file",content:a};j(h=>({...h,children:[...h.children||[],u]})),setTimeout(A,500)},t.readAsText(i),n.target.value=""},V=n=>{T(i=>{const t=new Set(i);return t.has(n)?t.delete(n):t.add(n),t})},y=(n,i,t,l)=>{C(e=>{const a=u=>u.map(r=>r.id===n?{...r,status:i,duration:t,message:l}:r.children?{...r,children:a(r.children)}:r);return a(e)})},E=async n=>{var v;y(n.id,"running");let i=`npm test -- ${n.file}`;n.file.endsWith(".py")&&(i=`pytest ${n.file}`),n.file.endsWith(".go")&&(i=`go test ./${n.file.substring(0,n.file.lastIndexOf("/"))}`),n.file.endsWith(".rs")&&(i=`cargo test --test ${n.name}`),w(i);const t=`${d.name}/${n.file}`,e=((v=R(d).find(m=>m.name===t))==null?void 0:v.content)||"",a=D.filter(m=>m.file===n.file),u=U.some(m=>m.enabled&&m.id==="iam-root"&&e.includes("root")),r=e.includes("// FAIL")||e.includes("# FAIL")||e.includes("expect(true).toBe(false)")||e.includes("assert False")||e.includes("panic("),h=Math.floor(Math.random()*100)+20;await new Promise(m=>setTimeout(m,h+300)),a.length>0?y(n.id,"failed",h,`Security Violation: ${a[0].description}`):u?y(n.id,"failed",h,'Policy Violation: Usage of "root" credentials detected.'):r?y(n.id,"failed",h,"Assertion Error: expected true to be false"):y(n.id,"passed",h)},J=async()=>{k(!0),O("Running test suite...");const n=l=>l.map(e=>({...e,status:"idle",message:void 0,children:e.children?n(e.children):void 0}));C(l=>n(l));const i=l=>{let e=[];return l.forEach(a=>{a.type==="test"&&e.push(a),a.children&&(e=e.concat(i(a.children)))}),e},t=i(p);for(const l of t)await E(l);k(!1)},I=p.reduce((n,i)=>{var t;return n+(((t=i.children)==null?void 0:t.length)||(i.type==="test"?1:0))},0),X=p.reduce((n,i)=>{var t;return n+(((t=i.children)==null?void 0:t.filter(l=>l.status!=="idle"&&l.status!=="running").length)||(i.status!=="idle"&&i.status!=="running"?1:0))},0),q=I>0?X/I*100:0,L=(n,i=0)=>n.map(t=>s.jsxs("div",{children:[s.jsxs("div",{className:"flex items-start gap-2 py-1.5 px-1 hover:bg-[var(--color-background-tertiary)] rounded cursor-pointer group/item",style:{paddingLeft:`${i*12+4}px`},onClick:()=>t.children&&V(t.id),children:[t.children&&t.children.length>0?F.has(t.id)?s.jsx(Y,{size:12,className:"text-gray-500 mt-1"}):s.jsx(Z,{size:12,className:"text-gray-500 mt-1"}):s.jsx("span",{className:"w-3"}),t.type==="suite"?i===0?s.jsx(ee,{size:14,className:"text-blue-400 mt-0.5"}):s.jsx(se,{size:14,className:"text-purple-400 mt-0.5"}):s.jsx("div",{className:"w-3.5"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("span",{className:`text-xs ${i===0?"text-gray-300 font-bold":"text-gray-400"} truncate`,children:t.name}),s.jsxs("div",{className:"flex items-center gap-2",children:[t.duration&&s.jsxs("span",{className:"text-[10px] text-gray-600 flex items-center gap-0.5",children:[s.jsx(te,{size:10})," ",t.duration,"ms"]}),s.jsxs("div",{className:"w-4 flex justify-center",children:[t.status==="running"&&s.jsx("div",{className:"w-3 h-3 border-2 border-gray-500 border-t-transparent rounded-full animate-spin"}),t.status==="passed"&&s.jsx(ne,{size:14,className:"text-green-500"}),t.status==="failed"&&s.jsx(ae,{size:14,className:"text-red-500"})]})]})]}),t.message&&s.jsx("div",{className:"text-[10px] text-red-400 mt-1 pl-1 border-l-2 border-red-500/50",children:t.message})]}),s.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover/item:opacity-100 transition-opacity",children:[s.jsx("button",{onClick:l=>{l.stopPropagation(),B(`${d.name}/${t.file}`)},className:"p-1 hover:bg-gray-600 rounded text-blue-400",title:"Go to File",children:s.jsx(ie,{size:12})}),s.jsx("button",{onClick:l=>{l.stopPropagation(),E(t)},className:"p-1 hover:bg-gray-600 rounded text-green-400",title:t.type==="test"?"Run Test":"Run Suite",children:s.jsx(_,{size:10,fill:"currentColor"})})]})]}),t.children&&F.has(t.id)&&s.jsx("div",{children:L(t.children,i+1)})]},t.id));return s.jsxs("div",{className:"p-2 h-full flex flex-col bg-[var(--color-background-secondary)] text-[var(--color-text-primary)]",children:[s.jsxs("div",{className:"flex justify-between items-center p-2 flex-shrink-0",children:[s.jsx("h2",{className:"text-xs font-bold uppercase text-[var(--color-text-secondary)]",children:"Testing"}),s.jsx("button",{onClick:o,title:"Collapse Panel",className:"text-[var(--color-text-secondary)] hover:text-white p-1 rounded-md hover:bg-[var(--color-background-tertiary)]",children:le.COLLAPSE_LEFT})]}),s.jsxs("div",{className:"px-2 pb-2 flex-shrink-0",children:[s.jsxs("div",{className:"mb-3",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("h3",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider flex items-center gap-1",children:[s.jsx(H,{size:12})," Test Discovery"]}),s.jsxs("button",{onClick:A,className:"text-[10px] flex items-center gap-1 text-[var(--color-accent)] hover:text-[var(--color-accent-hover)] transition-colors",children:[s.jsx(G,{size:10,className:S?"animate-spin":""}),S?"Scanning...":"Scan Project"]})]}),s.jsx("input",{type:"file",ref:P,onChange:M,className:"hidden",accept:".js,.ts,.tsx,.py,.go,.rs,.java,.c,.cpp"}),s.jsx("div",{onClick:()=>{var n;return(n=P.current)==null?void 0:n.click()},className:"w-full border border-dashed border-[var(--color-border)] rounded-md p-3 text-center cursor-pointer hover:bg-[var(--color-background-tertiary)] hover:border-[var(--color-accent)] transition-colors group",children:s.jsxs("div",{className:"flex items-center justify-center gap-2 text-xs text-gray-500 group-hover:text-gray-300",children:[s.jsx(K,{size:14}),s.jsx("span",{children:"Drag test files here or click to add"})]})})]}),s.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded p-2 mb-3",children:[s.jsxs("div",{className:"flex items-center gap-2 text-blue-300 text-xs font-bold mb-1",children:[s.jsx(Q,{size:12})," Policy Enforcement Active"]}),s.jsx("p",{className:"text-[10px] text-gray-400",children:"Tests will fail if code violates active security policies."})]}),s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("button",{onClick:J,disabled:N,className:`w-full group relative overflow-hidden rounded-md py-2 px-3 text-xs font-bold text-white shadow-lg transition-all duration-200 
                    ${N?"bg-gray-700 cursor-not-allowed":"bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-500 hover:to-blue-500 hover:shadow-purple-500/20 hover:scale-[1.01]"}`,children:s.jsx("div",{className:"relative flex items-center justify-center gap-2 z-10",children:N?s.jsxs(s.Fragment,{children:[s.jsx(G,{size:12,className:"animate-spin"}),s.jsx("span",{children:"Running Suite..."})]}):s.jsxs(s.Fragment,{children:[s.jsx(_,{size:12,fill:"currentColor",className:"group-hover:text-white"}),s.jsx("span",{children:"Run All Checks"})]})})}),N&&s.jsx("div",{className:"h-1 w-full bg-gray-700 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300",style:{width:`${q}%`}})})]}),s.jsxs("div",{className:"mt-2 text-[10px] text-gray-500 italic px-1",children:["Supports ",s.jsx("span",{className:"text-gray-400 font-mono",children:"JS, TS, Python, Go, Rust"})," tests."]})]}),s.jsx("div",{className:"flex-1 overflow-y-auto px-2 mt-2 space-y-1",children:p.length===0?s.jsx("div",{className:"text-center py-10 text-gray-500 text-xs",children:s.jsx("p",{children:"No tests found."})}):s.jsx("div",{className:"text-xs font-mono select-none",children:L(p)})})]})};export{ue as default};
