import{v as c,j as e,k as K,aq as Q,ap as X,y as ee}from"./vendor-react-tt7m-l12.js";const te="https://api.github.com",q=async(s,a=3,o=1e3)=>{try{return await s()}catch(t){if(a===0)throw t;if(t.status===403||t.status>=500&&t.status<600)return console.warn(`GitHub API call failed. Retrying in ${o}ms...`),await new Promise(i=>setTimeout(i,o)),q(s,a-1,o*2);throw t}},x=async(s,a,o={})=>q(async()=>{const t=await fetch(`${te}${s}`,{...o,headers:{...o.headers,Authorization:`token ${a}`,Accept:"application/vnd.github.v3+json"}});if(!t.ok){const h=await t.json().catch(()=>({message:`GitHub API error: ${t.status} ${t.statusText}`})),i=new Error(h.message||`GitHub API error: ${t.status}`);throw i.status=t.status,i}return t.status===204?null:t.json()}),re=s=>x("/user/repos?sort=updated&per_page=100",s),se=async(s,a,o,t)=>x("/user/repos",s,{method:"POST",body:JSON.stringify({name:a,description:o,private:t,auto_init:!0})}),ae=async(s,a,o)=>(await x(`/repos/${a}/git/ref/heads/${o}`,s)).object.sha,L=(s,a)=>{const o=a?`${a}/${s.name}`:s.name;return s.type==="file"?typeof s.content=="string"?[{path:o,content:s.content}]:[]:s.type==="folder"&&s.children?s.children.flatMap(t=>L(t,o)):[]},oe=async(s,a,o,t,h,i,d)=>{var N;d("Flattening file structure...");const g=((N=i.children)==null?void 0:N.flatMap(m=>L(m,"")))||[];if(g.length===0)throw new Error("No files with content found to commit.");d(`Getting info for base branch '${o}'...`);const p=await ae(s,a,o),b=(await x(`/repos/${a}/git/commits/${p}`,s)).tree.sha;d(`Creating ${g.length} file blobs...`);const v=g.map(m=>x(`/repos/${a}/git/blobs`,s,{method:"POST",body:JSON.stringify({content:m.content,encoding:"utf-8"})})),f=await Promise.all(v);d("Creating new git tree...");const w=g.map((m,y)=>({path:m.path,mode:"100644",type:"blob",sha:f[y].sha})),j=await x(`/repos/${a}/git/trees`,s,{method:"POST",body:JSON.stringify({tree:w,base_tree:b})});d("Creating commit...");const S=await x(`/repos/${a}/git/commits`,s,{method:"POST",body:JSON.stringify({message:h,tree:j.sha,parents:[p]})});return d(`Creating new branch '${t}'...`),await x(`/repos/${a}/git/refs`,s,{method:"POST",body:JSON.stringify({ref:`refs/heads/${t}`,sha:S.sha})}),d("Done!"),`https://github.com/${a}/tree/${t}`},E={getUserRepos:re,createCommit:oe,createRepo:se},ne=({isOpen:s,onClose:a,fileStructure:o,token:t,onSetToken:h,initialCommitMessage:i})=>{const[d,g]=c.useState(""),[p,R]=c.useState([]),[b,v]=c.useState("existing"),[f,w]=c.useState(""),[j,S]=c.useState(""),[N,m]=c.useState(""),[y,$]=c.useState(!1),[k,P]=c.useState(""),[T,A]=c.useState("feat: initial commit from SAI"),[W,n]=c.useState("idle"),[V,_]=c.useState(""),[G,u]=c.useState(""),[M,D]=c.useState(null),[O,H]=c.useState("");c.useEffect(()=>{s&&(z(),i&&A(i),t?B():n("token-needed"))},[s,t,i]);const z=()=>{R([]),w(""),v("existing"),S(""),m(""),$(!1),P(""),A(i||"feat: initial commit from SAI"),n("idle"),u(""),H(""),_(""),g(""),D(null)},B=async()=>{if(t){n("loading-repos"),u(""),D("fetch");try{const r=await E.getUserRepos(t);R(r),r.length>0&&w(r[0].full_name),n("ready")}catch(r){u(r.message),n("error")}}},Y=()=>{d.trim()&&h(d.trim())},J=async()=>{if(!t)return;let r=f,C="main";if(u(""),b==="create"){if(!j.trim()){u("Repository name is required."),n("error");return}n("creating-repo"),_("Creating new repository...");try{const l=await E.createRepo(t,j,N,y);r=l.full_name,C=l.default_branch||"main",await new Promise(I=>setTimeout(I,1500))}catch(l){u(`Failed to create repository: ${l.message}`),n("error");return}}else{const l=p.find(I=>I.full_name===f);if(!l){u("Please select a repository."),n("error");return}r=l.full_name,C=l.default_branch}if(!k.trim()||!T.trim()){u("Branch name and commit message are required."),n("error");return}n("pushing"),D("push");try{const l=await E.createCommit(t,r,C,k,T,o,_);H(l),n("success")}catch(l){u(l.message),n("error")}},Z=()=>{M==="fetch"?B():M==="push"?J():(z(),t?B():n("token-needed"))},U=c.useMemo(()=>p.find(r=>r.full_name===f),[p,f]);if(c.useEffect(()=>{if(!k){const r=o.name.replace(/[^a-zA-Z0-9-]/g,"-")||"feature",C=new Date().toISOString().slice(0,19).replace(/[-:T]/g,"");P(`${r}-${C}`)}},[o,k]),!s)return null;const F=()=>{switch(W){case"token-needed":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-sm text-[var(--color-text-secondary)]",children:["Please provide a GitHub Personal Access Token with ",e.jsx("code",{className:"bg-black/30 px-1 rounded",children:"repo"})," scope to continue."]}),e.jsx("a",{href:"https://github.com/settings/tokens/new?scopes=repo",target:"_blank",rel:"noopener noreferrer",className:"text-sm text-[var(--color-text-accent)] hover:underline",children:"How to create a token?"}),e.jsx("input",{type:"password",value:d,onChange:r=>g(r.target.value),placeholder:"ghp_...",className:"w-full bg-[var(--color-background-tertiary)] border border-[var(--color-border)] rounded px-2 py-1.5 text-sm focus:outline-none focus:ring-1 focus:ring-[var(--color-accent)]"}),e.jsx("button",{onClick:Y,className:"w-full bg-[var(--color-accent)] hover:bg-[var(--color-accent-hover)] text-white font-semibold py-2 rounded-lg text-sm",children:"Set Token & Fetch Repos"}),e.jsx("button",{onClick:a,className:"w-full text-center text-xs text-[var(--color-text-secondary)] hover:text-white",children:"Cancel"})]});case"loading-repos":return e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 space-y-3",children:[e.jsxs("svg",{className:"animate-spin h-6 w-6 text-[var(--color-accent)]",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("p",{className:"text-sm text-[var(--color-text-secondary)]",children:"Fetching your repositories..."})]});case"ready":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex bg-black/20 p-1 rounded-lg",children:[e.jsxs("button",{onClick:()=>v("existing"),className:`flex-1 py-1.5 text-xs font-medium rounded-md flex items-center justify-center gap-2 transition-all ${b==="existing"?"bg-[var(--color-background-hover)] text-white shadow":"text-gray-400 hover:text-white"}`,children:[e.jsx(K,{size:14})," Existing Repo"]}),e.jsxs("button",{onClick:()=>v("create"),className:`flex-1 py-1.5 text-xs font-medium rounded-md flex items-center justify-center gap-2 transition-all ${b==="create"?"bg-[var(--color-background-hover)] text-white shadow":"text-gray-400 hover:text-white"}`,children:[e.jsx(Q,{size:14})," Create New Repo"]})]}),b==="existing"?e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--color-text-secondary)] block mb-1",children:"Select Repository"}),e.jsx("select",{value:f,onChange:r=>w(r.target.value),className:"w-full bg-[var(--color-background-tertiary)] border border-[var(--color-border)] rounded px-2 py-1.5 text-sm focus:outline-none focus:ring-1 focus:ring-[var(--color-accent)]",children:p.map(r=>e.jsx("option",{value:r.full_name,children:r.full_name},r.id))}),U&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Base branch: ",U.default_branch]})]}):e.jsxs("div",{className:"space-y-3 p-3 bg-black/20 rounded-lg border border-gray-700/50",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--color-text-secondary)] block mb-1",children:"Repository Name"}),e.jsx("input",{type:"text",value:j,onChange:r=>S(r.target.value),placeholder:"my-awesome-project",className:"w-full bg-[var(--color-background-tertiary)] border border-[var(--color-border)] rounded px-2 py-1.5 text-sm focus:outline-none focus:ring-1 focus:ring-[var(--color-accent)]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--color-text-secondary)] block mb-1",children:"Description (Optional)"}),e.jsx("input",{type:"text",value:N,onChange:r=>m(r.target.value),placeholder:"A short description...",className:"w-full bg-[var(--color-background-tertiary)] border border-[var(--color-border)] rounded px-2 py-1.5 text-sm focus:outline-none focus:ring-1 focus:ring-[var(--color-accent)]"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:`flex items-center gap-2 cursor-pointer p-2 rounded border ${y?"border-gray-700 text-gray-400":"bg-[var(--color-accent)]/20 border-[var(--color-accent)] text-white"}`,children:[e.jsx("input",{type:"radio",checked:!y,onChange:()=>$(!1),className:"hidden"}),e.jsx(X,{size:14})," Public"]}),e.jsxs("label",{className:`flex items-center gap-2 cursor-pointer p-2 rounded border ${y?"bg-[var(--color-accent)]/20 border-[var(--color-accent)] text-white":"border-gray-700 text-gray-400"}`,children:[e.jsx("input",{type:"radio",checked:y,onChange:()=>$(!0),className:"hidden"}),e.jsx(ee,{size:14})," Private"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--color-text-secondary)] block mb-1",children:"New Branch Name"}),e.jsx("input",{type:"text",value:k,onChange:r=>P(r.target.value),className:"w-full bg-[var(--color-background-tertiary)] border border-[var(--color-border)] rounded px-2 py-1.5 text-sm focus:outline-none focus:ring-1 focus:ring-[var(--color-accent)]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-medium text-[var(--color-text-secondary)] block mb-1",children:"Commit Message"}),e.jsx("input",{type:"text",value:T,onChange:r=>A(r.target.value),className:"w-full bg-[var(--color-background-tertiary)] border border-[var(--color-border)] rounded px-2 py-1.5 text-sm focus:outline-none focus:ring-1 focus:ring-[var(--color-accent)]"})]}),e.jsx("button",{onClick:J,className:"w-full bg-green-600 hover:bg-green-500 text-white font-semibold py-2 rounded-lg text-sm transition-colors shadow-lg",children:b==="create"?"Create Repo & Push":"Push to New Branch"})]});case"creating-repo":case"pushing":return e.jsxs("div",{className:"flex flex-col items-center justify-center p-8 space-y-3",children:[e.jsxs("svg",{className:"animate-spin h-6 w-6 text-[var(--color-accent)]",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("p",{className:"text-sm text-[var(--color-text-secondary)]",children:V||"Processing..."})]});case"success":return e.jsxs("div",{className:"text-center p-8",children:[e.jsx("h3",{className:"text-lg font-bold text-green-400 mb-2",children:"Success!"}),e.jsx("p",{className:"text-sm text-[var(--color-text-secondary)] mb-4",children:"Your code has been pushed successfully."}),e.jsx("a",{href:O,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-[var(--color-text-accent)] hover:underline break-all block mb-4",children:O}),e.jsx("button",{onClick:a,className:"w-full bg-blue-600 hover:bg-blue-500 text-white font-semibold py-2 rounded-lg text-sm",children:"Close"})]});case"error":return e.jsxs("div",{className:"text-center p-8",children:[e.jsx("h3",{className:"text-lg font-bold text-red-400 mb-2",children:"Error"}),e.jsx("p",{className:"text-sm text-red-400/80 bg-red-900/20 p-2 rounded-md break-words",children:G}),G.toLowerCase().includes("token")&&e.jsx("button",{onClick:()=>{h(null),z(),n("token-needed")},className:"mt-4 w-full bg-yellow-600 hover:bg-yellow-500 text-white font-semibold py-2 rounded-lg text-sm",children:"Change Token"}),e.jsx("button",{onClick:Z,className:"mt-4 w-full bg-gray-600 hover:bg-gray-500 text-white font-semibold py-2 rounded-lg text-sm",children:"Retry"}),e.jsx("button",{onClick:a,className:"mt-2 w-full text-center text-xs text-[var(--color-text-secondary)] hover:text-white",children:"Cancel"})]});default:return null}};return e.jsx("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 animate-fade-in",onClick:a,children:e.jsxs("div",{className:"bg-[#131b2c] rounded-2xl p-6 w-full max-w-lg text-white border border-gray-700 shadow-xl max-h-[90vh] overflow-y-auto",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Save to GitHub"}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-white",children:"Ã—"})]}),F()]})})};export{ne as default};
